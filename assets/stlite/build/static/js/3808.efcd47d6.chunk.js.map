{"version":3,"file":"static/js/3808.efcd47d6.chunk.js","mappings":"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","sources":["../../../streamlit/frontend/lib/src/components/elements/DeckGlJsonChart/withMapboxToken/MapboxTokenError.tsx","../../../streamlit/frontend/lib/src/components/elements/DeckGlJsonChart/withMapboxToken/withMapboxToken.tsx","../../../streamlit/frontend/lib/src/components/elements/DeckGlJsonChart/styled-components.ts","../../../streamlit/frontend/lib/src/components/elements/DeckGlJsonChart/DeckGlJsonChart.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement } from \"react\"\nimport ErrorElement from \"@streamlit/lib/src/components/shared/ErrorElement\"\nimport {\n  MapboxTokenFetchingError,\n  MapboxTokenNotProvidedError,\n} from \"./withMapboxToken\"\n\ninterface Props {\n  error: Error | MapboxTokenFetchingError | MapboxTokenNotProvidedError\n  deltaType: string\n  width: number\n}\n\nconst MapboxTokenError = ({\n  error,\n  width,\n  deltaType,\n}: Props): ReactElement => {\n  if (error instanceof MapboxTokenNotProvidedError) {\n    return (\n      <ErrorElement\n        width={width}\n        name=\"No Mapbox token provided\"\n        message={\n          <>\n            <p>\n              To use <code>st.{deltaType}</code> or <code>st.map</code> you\n              need to set up a Mapbox access token.\n            </p>\n\n            <p>\n              To get a token, create an account at{\" \"}\n              <a href=\"https://mapbox.com\">https://mapbox.com</a>. It's free\n              for moderate usage levels!\n            </p>\n\n            <p>\n              Once you have a token, just set it using the Streamlit config\n              option <code>mapbox.token</code> and don't forget to restart your\n              Streamlit server at this point if it's still running, then reload\n              this tab.\n            </p>\n\n            <p>\n              See{\" \"}\n              <a href=\"https://docs.streamlit.io/library/advanced-features/configuration#view-all-configuration-options\">\n                our documentation\n              </a>{\" \"}\n              for more info on how to set config options.\n            </p>\n          </>\n        }\n      />\n    )\n  }\n\n  if (error instanceof MapboxTokenFetchingError) {\n    return (\n      <ErrorElement\n        width={width}\n        name=\"Error fetching Streamlit Mapbox token\"\n        message={\n          <>\n            <p>This app requires an internet connection.</p>\n            <p>Please check your connection and try again.</p>\n            <p>\n              If you think this is a bug, please file bug report{\" \"}\n              <a href=\"https://github.com/streamlit/streamlit/issues/new/choose\">\n                here\n              </a>\n              .\n            </p>\n          </>\n        }\n      />\n    )\n  }\n\n  return (\n    <ErrorElement\n      width={width}\n      name=\"Error fetching Streamlit Mapbox token\"\n      message={error.message}\n    />\n  )\n}\n\nexport default MapboxTokenError\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ensureError } from \"@streamlit/lib/src/util/ErrorHandling\"\nimport hoistNonReactStatics from \"hoist-non-react-statics\"\nimport React, { ComponentType, PureComponent, ReactNode } from \"react\"\nimport MapboxTokenError from \"./MapboxTokenError\"\nimport axios from \"axios\"\nimport { DeckGlJsonChart } from \"@streamlit/lib/src/proto\"\nimport { Skeleton } from \"@streamlit/lib/src/components/elements/Skeleton\"\nimport { LibContext } from \"@streamlit/lib/src/components/core/LibContext\"\n\ninterface InjectedProps {\n  mapboxToken: string\n}\n\ninterface State {\n  mapboxToken?: string\n  mapboxTokenError?: Error\n  isFetching: boolean\n}\n\n// Wraps a Component expecting a \"mapboxToken\" prop.\n// The wrapped Component accepts a DeckGLJsonChart prop, which\n// incorporates the config.toml token (if provided) and omits the \"mapboxToken\" prop.\nexport type WrappedMapboxProps<P extends InjectedProps> = Omit<\n  P,\n  \"mapboxToken\"\n> & {\n  element: DeckGlJsonChart\n  width: number\n}\n\nexport class MapboxTokenNotProvidedError extends Error {}\nexport class MapboxTokenFetchingError extends Error {}\n\n/**\n * A remote file that stores user-visible tokens.\n */\nexport const TOKENS_URL = \"https://data.streamlit.io/tokens.json\"\nconst MAPBOX = \"mapbox\"\n\n/**\n * A higher-order component that fetches our mapbox token and passes\n * it through to the wrapped component.\n * This component uses tokens from config.toml first when available.\n * If the token fetch fails, an error will be rendered in place of the wrapped component.\n * This component is necessary as it's good practice to separate data collection\n * (mapbox token retrieval) and the actual rendering of a component.\n *\n * @param {string} deltaType In case of an exception we show an error with this\n */\n\nconst withMapboxToken =\n  (deltaType: string) =>\n  <P extends InjectedProps>(\n    WrappedComponent: ComponentType<React.PropsWithChildren<P>>\n  ) => {\n    // Return a wrapper that accepts the wrapped component's props, minus\n    // \"mapboxToken\". The wrapper will fetch the mapboxToken and inject it into\n    // the wrapped component automatically.\n    class WithMapboxToken extends PureComponent<WrappedMapboxProps<P>, State> {\n      public static readonly displayName = `withMapboxToken(${\n        WrappedComponent.displayName || WrappedComponent.name\n      })`\n\n      static contextType = LibContext\n\n      context!: React.ContextType<typeof LibContext>\n\n      public constructor(props: WrappedMapboxProps<P>) {\n        super(props)\n\n        this.state = {\n          isFetching: true,\n          mapboxToken: undefined,\n          mapboxTokenError: undefined,\n        }\n      }\n\n      /**\n       * Fetch the remote \"tokens.json\" set the \"mapbox\" in state.\n       * Throw an error if we can't contact TOKENS_URL or the token is missing.\n       */\n      public initMapboxToken = async (): Promise<void> => {\n        try {\n          const response = await axios.get(TOKENS_URL)\n          const { [MAPBOX]: token } = response.data\n\n          if (!token) {\n            throw new Error(`Missing token ${MAPBOX}`)\n          }\n\n          this.setState({\n            mapboxToken: token,\n            isFetching: false,\n          })\n        } catch (e) {\n          const error = ensureError(e)\n\n          this.setState({\n            mapboxTokenError: error,\n            isFetching: false,\n          })\n          throw new MapboxTokenFetchingError(\n            `${error.message} (${TOKENS_URL})`\n          )\n        }\n      }\n\n      public componentDidMount(): void {\n        const mapboxToken =\n          this.props.element.mapboxToken || this.context.libConfig.mapboxToken\n\n        if (mapboxToken) {\n          this.setState({\n            mapboxToken,\n            isFetching: false,\n          })\n        } else {\n          this.initMapboxToken()\n        }\n      }\n\n      public render = (): ReactNode => {\n        const { mapboxToken, mapboxTokenError, isFetching } = this.state\n        const { width } = this.props\n\n        // We got an error when fetching our mapbox token: show the error.\n        if (mapboxTokenError) {\n          return (\n            <MapboxTokenError\n              width={width}\n              error={mapboxTokenError}\n              deltaType={deltaType}\n            />\n          )\n        }\n\n        // If our mapboxToken hasn't been retrieved yet, show a loading\n        // skeleton.\n        if (isFetching) {\n          return <Skeleton />\n        }\n\n        // We have the mapbox token. Pass it through to our component.\n        return (\n          // (this.props as unknown as P) is required to work around a TS issue:\n          // https://github.com/microsoft/TypeScript/issues/28938#issuecomment-450636046\n          <WrappedComponent\n            {...(this.props as unknown as P)}\n            mapboxToken={mapboxToken}\n            width={width}\n          />\n        )\n      }\n    }\n\n    return hoistNonReactStatics(WithMapboxToken, WrappedComponent)\n  }\n\nexport default withMapboxToken\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport styled from \"@emotion/styled\"\nimport { hasLightBackgroundColor } from \"@streamlit/lib/src/theme\"\n\nexport interface StyledDeckGlChartProps {\n  width: number\n  height: number\n}\n\nexport const StyledDeckGlChart = styled.div<StyledDeckGlChartProps>(\n  ({ width, height, theme }) => ({\n    marginTop: theme.spacing.sm,\n    position: \"relative\",\n    height,\n    width,\n  })\n)\n\nexport const StyledNavigationControlContainer = styled.div(({ theme }) => ({\n  position: \"absolute\",\n  right: \"2.625rem\",\n  top: theme.spacing.md,\n  zIndex: 1,\n\n  // Update zoom buttons based on the active theme\n  \"button:not(:disabled)\": {\n    background: theme.colors.bgColor,\n\n    // Add a separator between buttons\n    \"& + button\": {\n      borderTopColor: theme.colors.secondaryBg,\n    },\n\n    // On dark backgrounds, invert the color for the + and - symbols\n    \"& span\": {\n      filter: hasLightBackgroundColor(theme) ? \"\" : \"invert(100%)\",\n    },\n  },\n}))\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PureComponent, ReactNode } from \"react\"\nimport { DeckGL } from \"deck.gl\"\nimport JSON5 from \"json5\"\nimport isEqual from \"lodash/isEqual\"\nimport { MapContext, StaticMap, NavigationControl } from \"react-map-gl\"\nimport { withTheme } from \"@emotion/react\"\nimport {\n  hasLightBackgroundColor,\n  EmotionTheme,\n} from \"@streamlit/lib/src/theme\"\n// We don't have Typescript defs for these imports, which makes ESLint unhappy\n/* eslint-disable import/no-extraneous-dependencies */\nimport * as layers from \"@deck.gl/layers\"\nimport { JSONConverter } from \"@deck.gl/json\"\nimport * as geoLayers from \"@deck.gl/geo-layers\"\nimport * as aggregationLayers from \"@deck.gl/aggregation-layers\"\nimport * as meshLayers from \"@deck.gl/mesh-layers\"\n/* eslint-enable */\n\nimport { CSVLoader } from \"@loaders.gl/csv\"\nimport { GLTFLoader } from \"@loaders.gl/gltf\"\nimport { registerLoaders } from \"@loaders.gl/core\"\n\nimport { withFullScreenWrapper } from \"@streamlit/lib/src/components/shared/FullScreenWrapper\"\nimport withMapboxToken from \"./withMapboxToken\"\n\nimport { DeckGlJsonChart as DeckGlJsonChartProto } from \"@streamlit/lib/src/proto\"\nimport {\n  StyledDeckGlChart,\n  StyledNavigationControlContainer,\n} from \"./styled-components\"\n\nimport \"mapbox-gl/dist/mapbox-gl.css\"\n\ninterface PickingInfo {\n  object: {\n    [key: string]: string\n  }\n}\n\ninterface DeckObject {\n  initialViewState: {\n    height: number\n    width: number\n  }\n  layers: Record<string, unknown>[]\n  mapStyle?: string | Array<string>\n}\n\nconst configuration = {\n  classes: { ...layers, ...aggregationLayers, ...geoLayers, ...meshLayers },\n}\n\nregisterLoaders([CSVLoader, GLTFLoader])\n\nconst jsonConverter = new JSONConverter({ configuration })\n\nexport interface DeckGLProps {\n  width: number\n  theme: EmotionTheme\n  mapboxToken: string\n  element: DeckGlJsonChartProto\n  isFullScreen?: boolean\n}\n\nexport interface PropsWithHeight extends DeckGLProps {\n  height?: number\n}\n\nexport interface State {\n  viewState: Record<string, unknown>\n  initialized: boolean\n  initialViewState: Record<string, unknown>\n  id: string | undefined\n  pydeckJson: any\n  isFullScreen: boolean\n  isLightTheme: boolean\n}\n\nexport const DEFAULT_DECK_GL_HEIGHT = 500\n\nexport class DeckGlJsonChart extends PureComponent<PropsWithHeight, State> {\n  readonly state = {\n    viewState: {\n      bearing: 0,\n      pitch: 0,\n      zoom: 11,\n    },\n    initialized: false,\n    initialViewState: {},\n    id: undefined,\n    pydeckJson: undefined,\n    isFullScreen: false,\n    isLightTheme: hasLightBackgroundColor(this.props.theme),\n  }\n\n  componentDidMount = (): void => {\n    // HACK: Load layers a little after loading the map, to hack around a bug\n    // where HexagonLayers were not drawing on first load but did load when the\n    // script got re-executed.\n    this.setState({\n      initialized: true,\n    })\n  }\n\n  static getDerivedStateFromProps(\n    props: Readonly<PropsWithHeight>,\n    state: Partial<State>\n  ): Partial<State> | null {\n    const deck = DeckGlJsonChart.getDeckObject(props, state)\n\n    // If the ViewState on the server has changed, apply the diff to the current state\n    if (!isEqual(deck.initialViewState, state.initialViewState)) {\n      const diff = Object.keys(deck.initialViewState).reduce(\n        (diff, key): any => {\n          // @ts-expect-error\n          if (deck.initialViewState[key] === state.initialViewState[key]) {\n            return diff\n          }\n\n          return {\n            ...diff,\n            // @ts-expect-error\n            [key]: deck.initialViewState[key],\n          }\n        },\n        {}\n      )\n\n      return {\n        viewState: { ...state.viewState, ...diff },\n        initialViewState: deck.initialViewState,\n      }\n    }\n\n    return null\n  }\n\n  static getDeckObject = (\n    props: PropsWithHeight,\n    state: Partial<State>\n  ): DeckObject => {\n    const { element, width, height, theme, isFullScreen } = props\n\n    const currFullScreen = isFullScreen ?? false\n\n    // Only parse JSON when not transitioning to/from fullscreen, the element id changes, or theme changes\n    if (\n      element.id !== state.id ||\n      state.isFullScreen !== currFullScreen ||\n      state.isLightTheme !== hasLightBackgroundColor(theme)\n    ) {\n      state.pydeckJson = JSON5.parse(element.json)\n      state.id = element.id\n    }\n\n    // If unset, use either the Mapbox light or dark style based on Streamlit's theme\n    // For Mapbox styles, see https://docs.mapbox.com/api/maps/styles/#mapbox-styles\n    if (!state.pydeckJson?.mapStyle) {\n      state.pydeckJson.mapStyle = `mapbox://styles/mapbox/${\n        hasLightBackgroundColor(theme) ? \"light\" : \"dark\"\n      }-v9`\n    }\n\n    // Set width and height based on the fullscreen state\n    if (isFullScreen) {\n      Object.assign(state.pydeckJson?.initialViewState, { width, height })\n    } else {\n      if (!state.pydeckJson?.initialViewState?.height) {\n        state.pydeckJson.initialViewState.height = DEFAULT_DECK_GL_HEIGHT\n      }\n      if (element.useContainerWidth) {\n        state.pydeckJson.initialViewState.width = width\n      }\n    }\n\n    state.isFullScreen = isFullScreen\n    state.isLightTheme = hasLightBackgroundColor(theme)\n\n    delete state.pydeckJson?.views // We are not using views. This avoids a console warning.\n\n    return jsonConverter.convert(state.pydeckJson)\n  }\n\n  createTooltip = (info: PickingInfo): Record<string, unknown> | boolean => {\n    const { element } = this.props\n\n    if (!info || !info.object || !element.tooltip) {\n      return false\n    }\n\n    const tooltip = JSON5.parse(element.tooltip)\n\n    // NB: https://deckgl.readthedocs.io/en/latest/tooltip.html\n    if (tooltip.html) {\n      tooltip.html = this.interpolate(info, tooltip.html)\n    } else {\n      tooltip.text = this.interpolate(info, tooltip.text)\n    }\n\n    return tooltip\n  }\n\n  interpolate = (info: PickingInfo, body: string): string => {\n    const matchedVariables = body.match(/{(.*?)}/g)\n    if (matchedVariables) {\n      matchedVariables.forEach((match: string) => {\n        const variable = match.substring(1, match.length - 1)\n\n        if (info.object.hasOwnProperty(variable)) {\n          body = body.replace(match, info.object[variable])\n        }\n      })\n    }\n    return body\n  }\n\n  onViewStateChange = ({ viewState }: State): void => {\n    this.setState({ viewState })\n  }\n\n  render(): ReactNode {\n    const deck = DeckGlJsonChart.getDeckObject(this.props, this.state)\n    const { viewState } = this.state\n    return (\n      <StyledDeckGlChart\n        className=\"stDeckGlJsonChart\"\n        width={deck.initialViewState.width}\n        height={deck.initialViewState.height}\n        data-testid=\"stDeckGlJsonChart\"\n      >\n        <DeckGL\n          viewState={viewState}\n          onViewStateChange={this.onViewStateChange}\n          height={deck.initialViewState.height}\n          width={deck.initialViewState.width}\n          layers={this.state.initialized ? deck.layers : []}\n          getTooltip={this.createTooltip}\n          ContextProvider={MapContext.Provider}\n          controller\n        >\n          <StaticMap\n            height={deck.initialViewState.height}\n            width={deck.initialViewState.width}\n            mapStyle={\n              deck.mapStyle &&\n              (typeof deck.mapStyle === \"string\"\n                ? deck.mapStyle\n                : deck.mapStyle[0])\n            }\n            mapboxApiAccessToken={\n              this.props.element.mapboxToken || this.props.mapboxToken\n            }\n          />\n          <StyledNavigationControlContainer>\n            <NavigationControl className=\"zoomButton\" showCompass={false} />\n          </StyledNavigationControlContainer>\n        </DeckGL>\n      </StyledDeckGlChart>\n    )\n  }\n}\n\nexport default withTheme(\n  withMapboxToken(\"st.pydeck_chart\")(withFullScreenWrapper(DeckGlJsonChart))\n)\n"],"names":["_ref","error","width","deltaType","MapboxTokenNotProvidedError","_jsx","ErrorElement","name","message","_jsxs","_Fragment","children","href","MapboxTokenFetchingError","Error","TOKENS_URL","MAPBOX","WrappedComponent","WithMapboxToken","PureComponent","constructor","props","super","context","initMapboxToken","async","response","axios","token","data","concat","this","setState","mapboxToken","isFetching","e","ensureError","mapboxTokenError","render","state","MapboxTokenError","Skeleton","undefined","componentDidMount","element","libConfig","displayName","contextType","LibContext","hoistNonReactStatics","StyledDeckGlChart","_styled","target","height","theme","marginTop","spacing","sm","position","StyledNavigationControlContainer","_ref2","right","top","md","zIndex","background","colors","bgColor","borderTopColor","secondaryBg","filter","hasLightBackgroundColor","configuration","classes","layers","aggregationLayers","geoLayers","meshLayers","registerLoaders","CSVLoader","GLTFLoader","jsonConverter","JSONConverter","DeckGlJsonChart","arguments","viewState","bearing","pitch","zoom","initialized","initialViewState","id","pydeckJson","isFullScreen","isLightTheme","createTooltip","info","object","tooltip","JSON5","html","interpolate","text","body","matchedVariables","match","forEach","variable","substring","length","hasOwnProperty","replace","onViewStateChange","getDerivedStateFromProps","deck","getDeckObject","isEqual","diff","Object","keys","reduce","key","className","DeckGL","getTooltip","ContextProvider","MapContext","controller","StaticMap","mapStyle","mapboxApiAccessToken","NavigationControl","showCompass","_state$pydeckJson","_state$pydeckJson4","currFullScreen","_state$pydeckJson2","_state$pydeckJson3","json","assign","useContainerWidth","views","convert","withTheme","withMapboxToken","withFullScreenWrapper"],"sourceRoot":""}